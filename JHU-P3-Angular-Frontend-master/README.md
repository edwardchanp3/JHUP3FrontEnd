# JHU-P3-Angular-Frontend
This is the Angular framework code for JHU P3 app

#HIPAA Hosting
For details on how to connect to the server contact Ryan for credentials.

-. Application: JHU-P3

Customer: JHU.
Application: P3 Vaccines
Components: Nginx, Html/JS front-end App, Nodejs API, Mysql, MongoDB.
Service User: jhup3api
Public IP Address: 64.28.103.28
API Admin App: https://64.28.103.28/admin#/
APP: https://64.28.103.28/
Deployment Status: Pending installation of true certificates; associate nginx server directive to the final domain that's going to be used. 

#Nginx and Reverse Proxy Configuration
need: host a front-end html/js application and also do reverse proxying to a nodejs api. 

Solution: see attached file for sample nginx configuration. 

Todo: configure the caching headers for the static assets for improving performance. Pablo did this using gzip compression

Dissection of the attached config file (the important none default parts)

root /var/www/JHU-P3-FRONT-END/www; this defines the physical path where the html/js application files are stored, nginx will look here first and return any files that matches the URI.


 location / {
try_files $uri $uri/ @jhup3api;
}

this location directive instructs nginx to look for files on the root if the path requested doesn't match any file then the request is to be processed by the location @jhup3api.


location @jhup3api {
proxy_pass http://jhup3api;
proxy_http_version 1.1;
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection 'upgrade';
proxy_set_header Host $host;
proxy_cache_bypass $http_upgrade;
}

This is the regular proxy pass configuration it will forward all requests to the upstream (an upstream is a set of services listening for requests) named jhup3api (the name matches but it doesn't have to it could be any other thing, it is just the name of the upstream - see below - )


upstream jhup3api {
        server localhost:5000;
}

An upstream is a pool of services responding to requests forwarded by nginx proxy_pass directive; this is useful for when we want to run several instances of the same service. For example if we would like to run 4 instances of a given nodejs app we will write this directive as: 

upstream jhup3api {
        server localhost:5000;
        server localhost:5001;
        server localhost:5002;
        server localhost:5003;
}


--=============================================================
#Copy below into a text file and add for Ngix and Static Asset of Reverse Proxy:
-- You should look at the following URL's in order to grasp a solid understanding
-- of Nginx configuration files in order to fully unleash the power of Nginx.
-- http://wiki.nginx.org/Pitfalls
-- http://wiki.nginx.org/QuickStart
-- http://wiki.nginx.org/Configuration

-- Generally, you will want to move this file somewhere, and start with a clean
-- file but keep this around for reference. Or just disable in sites-enabled.

-- Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.

-- Default server configuration

server {
	--listen 80 default_server;
	--listen [::]:80 default_server;

	-- SSL configuration
	
	listen 443 ssl default_server;
	listen [::]:443 ssl default_server;
	
	-- Note: You should disable gzip for SSL traffic.
	-- See: https://bugs.debian.org/773332
	
	-- Read up on ssl_ciphers to ensure a secure configuration.
	-- See: https://bugs.debian.org/765782
	
	-- Self signed certs generated by the ssl-cert package
	-- Don't use them in a production server!
	
	include snippets/snakeoil.conf;
	root /var/www/JHU-P3-FRONT-END/www;
	-- Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;

	server_name _;


	--Cache static assets for 1 Month
	location ~* \.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|htc|css|js|html|min.js)$ {
  		expires 1M;
  		access_log off;
		add_header Pragma public;
  		add_header Cache-Control "public";
	}

	location ~ /\. { deny all; }

	location / {
		try_files $uri $uri/ @jhup3api =404;
	}


	location @jhup3api {
		proxy_pass http://jhup3api;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection 'upgrade';
		proxy_set_header Host $host;
		proxy_cache_bypass $http_upgrade;
	}
}

--This offer the potential to add more API instances and simplifies the location() directives
upstream jhup3api {
        server localhost:5000;
}
--END FILE
--=============================================================
